The code is still hard to read and the comments are sparse, I'll work on that over the next week.
